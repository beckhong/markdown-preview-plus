"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function handlePromise(promise) {
    if (!promise)
        return;
    promise.catch((error) => {
        console.error(error);
        atom.notifications.addFatalError(error.toString(), {
            detail: error.message,
            stack: error.stack,
            dismissable: true,
        });
    });
}
exports.handlePromise = handlePromise;
const fs_1 = require("fs");
function isFileSync(filePath) {
    if (!fs_1.existsSync(filePath))
        return false;
    return fs_1.lstatSync(filePath).isFile();
}
exports.isFileSync = isFileSync;
function pairUp(arr, option) {
    if (arr.length % 2 !== 0) {
        atom.notifications.addWarning(`Invalid math delimiter configuration${option ? `in ${option}` : ''}`, {
            detail: `Expected even number of elements, but got "${arr.join(', ')}"`,
            dismissable: true,
        });
    }
    return arr.reduce(function (result, _value, index, array) {
        if (index % 2 === 0)
            result.push([array[index], array[index + 1]]);
        return result;
    }, []);
}
exports.pairUp = pairUp;
function isElement(node) {
    return node.nodeType === Node.ELEMENT_NODE;
}
exports.isElement = isElement;
const webview_handler_1 = require("./markdown-preview-view/webview-handler");
const renderer = require("./renderer");
const macros_util_1 = require("./macros-util");
async function copyHtml(text, filePath, renderLaTeX) {
    const view = new webview_handler_1.WebviewHandler('copy', async () => {
        view.init({
            userMacros: macros_util_1.loadUserMacros(),
            mathJaxConfig: Object.assign({}, atomConfig().mathConfig, { latexRenderer: 'SVG' }),
            context: 'copy-html',
        });
        view.setBasePath(filePath);
        const domDocument = await renderer.render({
            text,
            filePath,
            renderLaTeX,
            mode: 'copy',
        });
        const res = await view.update(domDocument.documentElement.outerHTML, renderLaTeX);
        if (res) {
            const html = res.replace(/"file:\/\/[^"#]*/g, '"');
            if (atom.config.get('markdown-preview-plus.richClipboard')) {
                const clipboard = await Promise.resolve().then(() => require('./clipboard'));
                clipboard.write({ text: html, html });
            }
            else {
                atom.clipboard.write(html);
            }
        }
        view.destroy();
    });
    view.element.style.pointerEvents = 'none';
    view.element.style.position = 'absolute';
    view.element.style.width = '0px';
    view.element.style.height = '0px';
    const ws = atom.views.getView(atom.workspace);
    ws.appendChild(view.element);
}
exports.copyHtml = copyHtml;
function atomConfig() {
    return atom.config.get('markdown-preview-plus');
}
exports.atomConfig = atomConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsU0FBZ0IsYUFBYSxDQUFDLE9BQXFCO0lBQ2pELElBQUksQ0FBQyxPQUFPO1FBQUUsT0FBTTtJQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBWSxFQUFFLEVBQUU7UUFDN0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNwQixJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDakQsTUFBTSxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3JCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztZQUNsQixXQUFXLEVBQUUsSUFBSTtTQUNsQixDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFWRCxzQ0FVQztBQUNELDJCQUEwQztBQUMxQyxTQUFnQixVQUFVLENBQUMsUUFBZ0I7SUFDekMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxRQUFRLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQTtJQUN2QyxPQUFPLGNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtBQUNyQyxDQUFDO0FBSEQsZ0NBR0M7QUFFRCxTQUFnQixNQUFNLENBQUksR0FBUSxFQUFFLE1BQWU7SUFDakQsSUFBSSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDeEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQzNCLHVDQUF1QyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUNyRTtZQUNFLE1BQU0sRUFBRSw4Q0FBOEMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRztZQUN2RSxXQUFXLEVBQUUsSUFBSTtTQUNsQixDQUNG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cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVByb21pc2UocHJvbWlzZTogUHJvbWlzZTxhbnk+KTogdm9pZCB7XG4gIGlmICghcHJvbWlzZSkgcmV0dXJuXG4gIHByb21pc2UuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEZhdGFsRXJyb3IoZXJyb3IudG9TdHJpbmcoKSwge1xuICAgICAgZGV0YWlsOiBlcnJvci5tZXNzYWdlLFxuICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgZGlzbWlzc2FibGU6IHRydWUsXG4gICAgfSlcbiAgfSlcbn1cbmltcG9ydCB7IGxzdGF0U3luYywgZXhpc3RzU3luYyB9IGZyb20gJ2ZzJ1xuZXhwb3J0IGZ1bmN0aW9uIGlzRmlsZVN5bmMoZmlsZVBhdGg6IHN0cmluZykge1xuICBpZiAoIWV4aXN0c1N5bmMoZmlsZVBhdGgpKSByZXR1cm4gZmFsc2VcbiAgcmV0dXJuIGxzdGF0U3luYyhmaWxlUGF0aCkuaXNGaWxlKClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhaXJVcDxUPihhcnI6IFRbXSwgb3B0aW9uPzogc3RyaW5nKTogQXJyYXk8W1QsIFRdPiB7XG4gIGlmIChhcnIubGVuZ3RoICUgMiAhPT0gMCkge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRXYXJuaW5nKFxuICAgICAgYEludmFsaWQgbWF0aCBkZWxpbWl0ZXIgY29uZmlndXJhdGlvbiR7b3B0aW9uID8gYGluICR7b3B0aW9ufWAgOiAnJ31gLFxuICAgICAge1xuICAgICAgICBkZXRhaWw6IGBFeHBlY3RlZCBldmVuIG51bWJlciBvZiBlbGVtZW50cywgYnV0IGdvdCBcIiR7YXJyLmpvaW4oJywgJyl9XCJgLFxuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKVxuICB9XG4gIHJldHVybiBhcnIucmVkdWNlPEFycmF5PFtULCBUXT4+KGZ1bmN0aW9uKHJlc3VsdCwgX3ZhbHVlLCBpbmRleCwgYXJyYXkpIHtcbiAgICBpZiAoaW5kZXggJSAyID09PSAwKSByZXN1bHQucHVzaChbYXJyYXlbaW5kZXhdLCBhcnJheVtpbmRleCArIDFdXSlcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0sIFtdKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNFbGVtZW50KG5vZGU6IE5vZGUpOiBub2RlIGlzIEVsZW1lbnQge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREVcbn1cblxuaW1wb3J0IHsgV2Vidmlld0hhbmRsZXIgfSBmcm9tICcuL21hcmtkb3duLXByZXZpZXctdmlldy93ZWJ2aWV3LWhhbmRsZXInXG5pbXBvcnQgKiBhcyByZW5kZXJlciBmcm9tICcuL3JlbmRlcmVyJ1xuaW1wb3J0IHsgbG9hZFVzZXJNYWNyb3MgfSBmcm9tICcuL21hY3Jvcy11dGlsJ1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvcHlIdG1sKFxuICB0ZXh0OiBzdHJpbmcsXG4gIGZpbGVQYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIHJlbmRlckxhVGVYOiBib29sZWFuLFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHZpZXcgPSBuZXcgV2Vidmlld0hhbmRsZXIoJ2NvcHknLCBhc3luYyAoKSA9PiB7XG4gICAgdmlldy5pbml0KHtcbiAgICAgIHVzZXJNYWNyb3M6IGxvYWRVc2VyTWFjcm9zKCksXG4gICAgICBtYXRoSmF4Q29uZmlnOiB7IC4uLmF0b21Db25maWcoKS5tYXRoQ29uZmlnLCBsYXRleFJlbmRlcmVyOiAnU1ZHJyB9LFxuICAgICAgY29udGV4dDogJ2NvcHktaHRtbCcsXG4gICAgfSlcbiAgICB2aWV3LnNldEJhc2VQYXRoKGZpbGVQYXRoKVxuXG4gICAgY29uc3QgZG9tRG9jdW1lbnQgPSBhd2FpdCByZW5kZXJlci5yZW5kZXIoe1xuICAgICAgdGV4dCxcbiAgICAgIGZpbGVQYXRoLFxuICAgICAgcmVuZGVyTGFUZVgsXG4gICAgICBtb2RlOiAnY29weScsXG4gICAgfSlcbiAgICBjb25zdCByZXMgPSBhd2FpdCB2aWV3LnVwZGF0ZShcbiAgICAgIGRvbURvY3VtZW50LmRvY3VtZW50RWxlbWVudCEub3V0ZXJIVE1MLFxuICAgICAgcmVuZGVyTGFUZVgsXG4gICAgKVxuICAgIGlmIChyZXMpIHtcbiAgICAgIGNvbnN0IGh0bWwgPSByZXMucmVwbGFjZSgvXCJmaWxlOlxcL1xcL1teXCIjXSovZywgJ1wiJylcbiAgICAgIGlmIChhdG9tLmNvbmZpZy5nZXQoJ21hcmtkb3duLXByZXZpZXctcGx1cy5yaWNoQ2xpcGJvYXJkJykpIHtcbiAgICAgICAgY29uc3QgY2xpcGJvYXJkID0gYXdhaXQgaW1wb3J0KCcuL2NsaXBib2FyZCcpXG4gICAgICAgIGNsaXBib2FyZC53cml0ZSh7IHRleHQ6IGh0bWwsIGh0bWwgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF0b20uY2xpcGJvYXJkLndyaXRlKGh0bWwpXG4gICAgICB9XG4gICAgfVxuICAgIHZpZXcuZGVzdHJveSgpXG4gIH0pXG4gIHZpZXcuZWxlbWVudC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnXG4gIHZpZXcuZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcbiAgdmlldy5lbGVtZW50LnN0eWxlLndpZHRoID0gJzBweCdcbiAgdmlldy5lbGVtZW50LnN0eWxlLmhlaWdodCA9ICcwcHgnXG4gIGNvbnN0IHdzID0gYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKVxuICB3cy5hcHBlbmRDaGlsZCh2aWV3LmVsZW1lbnQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhdG9tQ29uZmlnKCkge1xuICByZXR1cm4gYXRvbS5jb25maWcuZ2V0KCdtYXJrZG93bi1wcmV2aWV3LXBsdXMnKVxufVxuIl19